# Server Configuration - DEV Environment
# Shared static configuration values for Python and MJS server packages

# =============================================================================
# Provider Configuration
# All external API endpoints must be defined here (no hardcoded fallbacks)
# =============================================================================

providers:
  gemini:
    base_url: "https://generativelanguage.googleapis.com/v1beta/openai"
    model: "gemini-2.0-flash"
    env_api_key: "GEMINI_API_KEY"
    api_auth_type: "bearer"         # bearer, basic, x-api-key, custom
    token_resolver: "static"        # static (default), startup, request
    # Provider-specific configuration overrides (optional)
    # Overrides are deep-merged with global proxy/client settings
    # overwrite_root_config:
    #   proxy:
    #     # Override proxy for this provider only
    #     default_environment: "prod"
    #     proxy_urls:
    #       prod: "http://gemini-proxy:8080"
    #     cert_verify: true
    #     ca_bundle: "/path/to/custom-ca.crt"
    #   client:
    #     # Override timeout for this provider only
    #     timeout_seconds: 120.0
    #     timeout_ms: 120000
    #   headers:
    #     # Additional headers for this provider only
    #     X-Custom-Header: "value"
  openai:
    base_url: "https://api.openai.com/v1"
    model: "gpt-4"
    env_api_key: "OPENAI_API_KEY"
    api_auth_type: "bearer"
    token_resolver: "static"
  anthropic:
    base_url: "https://api.anthropic.com/v1"
    model: "claude-3-sonnet"
    env_api_key: "ANTHROPIC_API_KEY"
    api_auth_type: "x-api-key"       # Anthropic uses x-api-key header
    token_resolver: "static"
  figma:
    base_url: "https://api.figma.com/v1"
    env_api_key: "FIGMA_TOKEN"
    api_auth_type: "custom"             # Figma uses custom X-Figma-Token header
    token_resolver: "static"
    # Default HTTP headers
    headers:
      Accept: "application/json"
    # Custom environment variable mappings
    env_file_key: "FIGMA_FILE_KEY"
    env_project_id: "FIGMA_PROJECT_ID"
  github:
    base_url: "https://api.github.com"
    env_api_key: "GITHUB_TOKEN"
    env_api_key_fallbacks:
      - "GH_TOKEN"
      - "GITHUB_ACCESS_TOKEN"
      - "GITHUB_PAT"
    api_auth_type: "bearer"
    token_resolver: "static"
    # Default HTTP headers
    headers:
      Accept: "application/vnd.github+json"
      X-GitHub-Api-Version: "2022-11-28"
    # Custom environment variable mappings
    env_owner: "GITHUB_OWNER"
    env_repo: "GITHUB_REPO"
  jira:
    # Base URL includes API path: JIRA_BASE_URL="https://domain.atlassian.net/rest/api/2"
    # Full URL = base_url + health_endpoint
    base_url: null
    env_base_url: "JIRA_BASE_URL"
    env_api_key: "JIRA_API_TOKEN"
    env_email: "JIRA_EMAIL"
    health_endpoint: "/myself"
    api_auth_type: "basic_email_token"         # Jira Cloud uses Basic auth with email:token
    token_resolver: "static"
    # Default HTTP headers
    headers:
      Content-Type: "application/json"
      Accept: "application/json"
    # Custom environment variable mappings
    env_project_key: "JIRA_PROJECT_KEY"
    env_board_id: "JIRA_BOARD_ID"
  confluence:
    # Base URL includes API path: CONFLUENCE_BASE_URL="https://domain.atlassian.net/wiki/rest/api"
    # Full URL = base_url + health_endpoint
    base_url: null
    env_base_url: "CONFLUENCE_BASE_URL"
    env_api_key: "CONFLUENCE_API_TOKEN"
    env_email: "CONFLUENCE_EMAIL"
    health_endpoint: "/user/current"
    api_auth_type: "basic_email_token"         # Confluence Cloud uses Basic auth with email:token
    token_resolver: "static"
    # Default HTTP headers for API requests
    headers:
      Content-Type: "application/json"
      Accept: "application/json"
      X-Atlassian-Token: "no-check"  # Required for write operations (CSRF protection)
    # Custom environment variable mappings (env_{{name}}: "ENV_VAR_NAME")
    # Access via: provider.get_env_by_name("space_key") -> os.getenv("CONFLUENCE_SPACE_KEY")
    env_space_key: "CONFLUENCE_SPACE_KEY"
    env_parent_page_id: "CONFLUENCE_PARENT_PAGE_ID"
    # Provider-specific network/proxy configuration (overrides global proxy settings)
    proxy_url: null       # Proxy URL for Confluence requests (e.g., "http://proxy:8080")
    ca_bundle: null       # CA bundle path for SSL verification
    cert: null            # Client certificate path
    cert_verify: false    # SSL certificate verification (false = disable)
    agent_proxy:          # Agent proxy settings
      http_proxy: null
      https_proxy: null
  # Database providers
  postgres:
    env_connection_url: "DATABASE_URL"
    health_query: "SELECT 1"
    api_auth_type: "connection_string"
    token_resolver: "static"
    ssl:
      rejectUnauthorized: false  # Accept self-signed certs from managed DBs
  redis:
    env_connection_url: "REDIS_URL"
    api_auth_type: "connection_string"
    token_resolver: "static"
  # SauceLabs
  saucelabs:
    base_url: "https://api.us-west-1.saucelabs.com"
    env_username: "SAUCE_USERNAME"
    env_username_fallbacks:
      - "SAUCELABS_USERNAME"
    env_api_key: "SAUCE_ACCESS_KEY"
    env_api_key_fallbacks:
      - "SAUCELABS_ACCESS_KEY"
    health_endpoint: "/rest/v1/users/:username"
    api_auth_type: "basic"           # SauceLabs uses Basic auth with username:access_key
    token_resolver: "static"
  # Sonar (SonarQube/SonarCloud)
  sonar:
    base_url: "https://sonarcloud.io"  # or https://your-sonar.example.com for SonarQube
    env_api_key: "SONAR_TOKEN"
    env_api_key_fallbacks:
      - "SONARQUBE_TOKEN"
      - "SONARCLOUD_TOKEN"
      - "SONAR_API_TOKEN"
    health_endpoint: "/api/authentication/validate"
    api_auth_type: "bearer"
    token_resolver: "static"
  # Akamai Edge API (EdgeGrid authentication)
  akamai:
    base_url: null  # Set via AKAMAI_HOST or .edgerc file
    env_client_token: "AKAMAI_CLIENT_TOKEN"
    env_client_secret: "AKAMAI_CLIENT_SECRET"
    env_access_token: "AKAMAI_ACCESS_TOKEN"
    env_host: "AKAMAI_HOST"
    health_endpoint: "/-/client-api/active-grants/implicit"
    api_auth_type: "edgegrid"  # Akamai EdgeGrid signature-based auth
    token_resolver: "static"
  # Placeholder providers (not implemented)
  rally:
    placeholder: true
    message: "Rally integration not implemented"
  elasticsearch:
    placeholder: true
    message: "Elasticsearch integration not implemented"
    # Example: Full overwrite_root_config for on-prem/VPN provider
    # overwrite_root_config:
    #   client:
    #     timeout_seconds: 120.0
    #     timeout_ms: 120000
    #   proxy:
    #     default_environment: "dev"
    #     proxy_urls: {}
    #     ca_bundle: null
    #     cert: null
    #     cert_verify: false
    #     agent_proxy:
    #       http_proxy: null
    #       https_proxy: null

# Default provider for backward compatibility
default_provider: "gemini"

# =============================================================================
# Client Configuration
# =============================================================================

client:
  # Timeout values in seconds (Python) / milliseconds (MJS)
  timeout_seconds: 60.0
  timeout_ms: 60000
  # Keep-alive timeout
  keep_alive_timeout_seconds: 5.0
  keep_alive_timeout_ms: 5000
  # Connection pool
  max_connections: 10

# =============================================================================
# Display Configuration
# =============================================================================

display:
  separator_char: "="
  thin_separator_char: "-"
  separator_length: 60

# =============================================================================
# Proxy Configuration
# =============================================================================

# shoudld be renamed to network
proxy:
  # Default environment name for ProxyDispatcherFactory
  # Used to select which proxy URL from proxy_urls to use
  default_environment: "dev"
  # Per-environment proxy URLs (keys are user-defined environment names)
  # Keys can be anything: Live, STAGING, Preview, dev, qa, prod, etc.
  proxy_urls: {}  # Empty dict = no per-env proxies configured
  # CA bundle path (null means use system default, missing means fall through to ENV)
  ca_bundle: null
  # Client certificate path (null means no cert, missing means fall through to ENV)
  cert: null
  # SSL certificate verification (false = disable verification, true = enable)
  # Default: false for dev/local environments behind corporate proxy
  cert_verify: false
  # Agent proxy settings (null means no proxy)
  agent_proxy:
    http_proxy: null
    https_proxy: null

# =============================================================================
# Services Configuration (Downstream Service Configs)
# =============================================================================
# Unstructured configuration for downstream services.
# Each service can have arbitrary key-value pairs accessible via:
#   - provider.get_service_config() -> returns entire service config dict
#   - provider.get_env_by_name("KEY") -> resolves env_KEY from config
#
# Convention for environment variables:
#   env_{{NAME}}: "{{ENV_VAR_NAME}}" -> resolved via get_env_by_name(NAME)
#
# Example usage in code:
#   provider = ConfluenceApiToken(static_config)
#   service_config = provider.get_service_config()
#   api_version = provider.get_env_by_name("api_version")  # reads env var from env_api_version
#
services:
  confluence:
    # Environment variable mappings (env_{{name}}: "ENV_VAR_NAME")
    env_api_version: "CONFLUENCE_API_VERSION"
    env_space_key: "CONFLUENCE_SPACE_KEY"
    env_parent_page_id: "CONFLUENCE_PARENT_PAGE_ID"

    # Default headers for Confluence API requests
    headers:
      X-Atlassian-Token: "no-check"  # Required for write operations
      Content-Type: "application/json"
      Accept: "application/json"

    # Default request configuration
    default_method: "GET"

    # Default query parameters for content API
    default_expand: "body.storage,version,container"

    # Pagination defaults
    pagination:
      limit: 25
      start: 0

    # Content type mappings
    content_types:
      page: "page"
      blogpost: "blogpost"
      comment: "comment"
      attachment: "attachment"

    # API endpoints (relative to base_url)
    endpoints:
      content: "/rest/api/content"
      space: "/rest/api/space"
      user: "/rest/api/user"
      search: "/rest/api/content/search"

  jira:
    # Environment variable mappings
    env_project_key: "JIRA_PROJECT_KEY"
    env_board_id: "JIRA_BOARD_ID"

    # Default headers
    headers:
      Content-Type: "application/json"
      Accept: "application/json"

    # API version
    api_version: "2"

    # Default JQL for searches
    default_jql_order: "created DESC"

    # Issue types
    issue_types:
      story: "Story"
      bug: "Bug"
      task: "Task"
      epic: "Epic"
      subtask: "Sub-task"

    # Pagination defaults
    pagination:
      max_results: 50
      start_at: 0

  github:
    # Environment variable mappings
    env_owner: "GITHUB_OWNER"
    env_repo: "GITHUB_REPO"

    # Default headers
    headers:
      Accept: "application/vnd.github+json"
      X-GitHub-Api-Version: "2022-11-28"

    # Pagination defaults
    pagination:
      per_page: 30
      page: 1

  # Template for adding new services:
  # service_name:
  #   env_custom_var: "ENV_VAR_NAME"
  #   headers:
  #     Custom-Header: "value"
  #   custom_key: "custom_value"
