# Makefile.tools - Tools and testing utilities
#
# Usage:
#   make -f Makefile.tools help
#   make -f Makefile.tools test-provider-connection
#   make -f Makefile.tools test-provider-connection-py
#   make -f Makefile.tools test-provider-connection-node
#
# Or include from main Makefile:
#   include Makefile.tools

# Get the directory where Makefile is located (project root)
MAKEFILE_DIR := $(dir $(abspath $(lastword $(MAKEFILE_LIST))))

# Use local .venv if it exists, otherwise use system Python
VENV_DIR := $(MAKEFILE_DIR).venv
PYTHON := $(if $(wildcard $(VENV_DIR)/bin/python),$(VENV_DIR)/bin/python,python)

# Provider connection test directory
PROVIDER_TEST_DIR := tools/testing/connection

# All providers to test
PROVIDERS := figma github jira confluence gemini openai saucelabs postgres redis

.PHONY: help-tools test-provider-connection test-provider-connection-py test-provider-connection-node test-provider-connection-all

help-tools:
	@echo "Makefile.tools - Testing utilities"
	@echo ""
	@echo "Provider Connection Tests:"
	@echo "  test-provider-connection       - Run all provider tests (Python + Node)"
	@echo "  test-provider-connection-py    - Run Python provider tests only"
	@echo "  test-provider-connection-node  - Run Node.js provider tests only"
	@echo "  test-provider-connection-all   - Run all_providers test (both Python + Node)"
	@echo ""
	@echo "Individual Provider Tests (Python):"
	@echo "  test-provider-py-figma         - Test Figma connection"
	@echo "  test-provider-py-github        - Test GitHub connection"
	@echo "  test-provider-py-jira          - Test Jira connection"
	@echo "  test-provider-py-confluence    - Test Confluence connection"
	@echo "  test-provider-py-gemini        - Test Gemini connection"
	@echo "  test-provider-py-openai        - Test OpenAI connection"
	@echo "  test-provider-py-saucelabs     - Test SauceLabs connection"
	@echo "  test-provider-py-postgres      - Test PostgreSQL connection"
	@echo "  test-provider-py-redis         - Test Redis connection"
	@echo ""
	@echo "Individual Provider Tests (Node.js):"
	@echo "  test-provider-node-figma       - Test Figma connection"
	@echo "  test-provider-node-github      - Test GitHub connection"
	@echo "  ... (same pattern for all providers)"

# =============================================================================
# Python Provider Tests
# =============================================================================

test-provider-connection-py:
	@echo "========================================"
	@echo "Running Python Provider Connection Tests"
	@echo "========================================"
	@poetry run python $(PROVIDER_TEST_DIR)/all_providers.py

# Individual Python provider tests
test-provider-py-figma:
	@poetry run python $(PROVIDER_TEST_DIR)/figma.py

test-provider-py-github:
	@poetry run python $(PROVIDER_TEST_DIR)/github.py

test-provider-py-jira:
	@poetry run python $(PROVIDER_TEST_DIR)/jira.py

test-provider-py-confluence:
	@poetry run python $(PROVIDER_TEST_DIR)/confluence.py

test-provider-py-gemini:
	@poetry run python $(PROVIDER_TEST_DIR)/gemini.py

test-provider-py-openai:
	@poetry run python $(PROVIDER_TEST_DIR)/openai.py

test-provider-py-saucelabs:
	@poetry run python $(PROVIDER_TEST_DIR)/saucelabs.py

test-provider-py-postgres:
	@poetry run python $(PROVIDER_TEST_DIR)/postgres.py

test-provider-py-redis:
	@poetry run python $(PROVIDER_TEST_DIR)/redis.py

# =============================================================================
# Node.js Provider Tests
# =============================================================================

test-provider-connection-node:
	@echo "========================================"
	@echo "Running Node.js Provider Connection Tests"
	@echo "========================================"
	@echo "NOTE: Requires 'pnpm build' to have been run first"
	@echo ""
	@node $(PROVIDER_TEST_DIR)/all_providers.mjs

# Individual Node.js provider tests
test-provider-node-figma:
	@node $(PROVIDER_TEST_DIR)/figma.mjs

test-provider-node-github:
	@node $(PROVIDER_TEST_DIR)/github.mjs

test-provider-node-jira:
	@node $(PROVIDER_TEST_DIR)/jira.mjs

test-provider-node-confluence:
	@node $(PROVIDER_TEST_DIR)/confluence.mjs

test-provider-node-gemini:
	@node $(PROVIDER_TEST_DIR)/gemini.mjs

test-provider-node-openai:
	@node $(PROVIDER_TEST_DIR)/openai.mjs

test-provider-node-saucelabs:
	@node $(PROVIDER_TEST_DIR)/saucelabs.mjs

test-provider-node-postgres:
	@node $(PROVIDER_TEST_DIR)/postgres.mjs

test-provider-node-redis:
	@node $(PROVIDER_TEST_DIR)/redis.mjs

# =============================================================================
# Combined Tests
# =============================================================================

# Run all_providers test for both Python and Node
test-provider-connection-all:
	@echo "========================================"
	@echo "Running All Provider Connection Tests"
	@echo "========================================"
	@echo ""
	@echo "--- Python ---"
	@poetry run python $(PROVIDER_TEST_DIR)/all_providers.py
	@echo ""
	@echo "--- Node.js ---"
	@node $(PROVIDER_TEST_DIR)/all_providers.mjs

# Run both Python and Node tests (alias for test-provider-connection-all)
test-provider-connection: test-provider-connection-all
